# 手数料とリワード

このページでは、zERC20のWrap / Unwrap手数料とWrapリワードの仕組みを説明します。

## 概要

zERC20は、すべてのサポートチェーン間で流動性のバランスを保つために、動的な手数料システムを採用しています。あるチェーンの流動性が目標値から乖離した場合、リバランスを促すインセンティブが働きます：

| アクション | 流動性が低いチェーン | 流動性が高いチェーン |
|--------|---------------------|----------------------|
| **Wrap** | Wrapリワードを獲得 | リワードなし |
| **Unwrap** | Unwrap手数料を支払う | 手数料なし |

## 手数料とリワードが存在する理由

各チェーンは、zERC20の供給を担保する原資産トークン（USDC、ETHなど）のプールを持っています。たとえばUSDCの大部分がEthereumに集中し、Arbitrumが枯渇した場合、ArbitrumユーザーはUnwrapが困難になります。

手数料・リワードシステムはこの問題を解決します：

- **流動性が低いチェーンへのデポジットにリワードを付与**（必要な場所に流動性を集める）
- **流動性が低いチェーンからの引き出しに手数料を課す**（希少な流動性の流出を抑制）

## 手数料の計算方法

手数料とリワードは、2つのパラメータに基づくインセンティブカーブ（Incentive Curve）を使って線形に計算されます：

- **流動性目標値（T）**：そのチェーンの理想的な流動性水準
- **インセンティブ強度（k）**：リバランスへの誘導の強さ

### 現在の手数料設定

| トークン | インセンティブ強度（k） | 備考 |
|-------|------------------------|-------|
| zUSDC | 10% | すべてのサポートチェーンで手数料・リワードが適用される |
| zETH | 10% | すべてのサポートチェーンで手数料・リワードが適用される |
| zBNB | — | 手数料・リワードなし（BNB ChainのみでWrap / Unwrap可能） |

> **📃 Note：** zBNBはOFTトークンとして複数チェーン（BNB Chain、Ethereum、Arbitrum、Base）に転送できます。ただし、Wrap / Unwrap（BNBとzBNBの変換）はBNB Chainのみ対応しています。原資産のクロスチェーン流動性調整が不要なため、手数料・リワードは発生しません。

**流動性目標値（T）** はバックグラウンドサービスによって自動計算されます：

```
目標値 = 全チェーンの合計流動性 / チェーン数 × ratio
```

デフォルトのratioは **80%** です。つまり、目標値は均等配分の80%に設定されています。これにより、ある程度の流動性変動では手数料・リワードが発生しません。流動性の移動に応じて目標値は自動調整されます。

### 計算式

手数料・リワードのレートは、流動性が目標値を下回るほど大きくなります：

```
流動性 L < 目標値 T のとき：
  地点 x でのレート = k × (1 - x/T)

流動性 L ≥ 目標値 T のとき：
  レート = 0（手数料・リワードなし）
```

実際の手数料またはリワードは、トランザクション前後の流動性水準の間の積分値（曲線下の面積）です。

### 計算例

あるチェーンの状況：
- 現在の流動性：50,000 USDC
- 流動性目標値：100,000 USDC
- インセンティブ強度：10%

**1,000 USDCをWrap**：流動性不足のチェーンに流動性を追加するため、49.5 USDCのWrapリワード（4.95%）を獲得できます。

**1,000 USDCをUnwrap**：流動性が目標値を下回っているため、50.5 USDCのUnwrap手数料（5.05%）が発生します。

## 手数料の蓄積

zERC20トークンUnwrapプロセスで発生した手数料は余剰手数料（Fee Surplus）プールとして蓄積されて。このプールは将来のWrapリワードの原資として使われます。プールが枯渇した場合、Wrapリワードは相応に減額されます。

## クロスチェーンUnwrapで手数料を節約する

あるチェーンの流動性が低くUnwrap手数料が高い場合、**クロスチェーンUnwrap**を使って別チェーンの流動性にアクセスし、手数料を抑えられます。

### 仕組み

1. チェーンA（zERC20を保有しているチェーン）でUnwrapを開始
2. zERC20をチェーンB（流動性が高いチェーン）にブリッジ
3. チェーンBで低い手数料でUnwrapを実行
4. 原資産トークンをチェーンAにブリッジして返送

この一連の処理は、LayerZeroとStargateを使って1トランザクションで完結します。

### クロスチェーンUnwrapを使うべき場面

- 現在のチェーンのUnwrap手数料が高い
- 別チェーンの流動性が多い（手数料が低い）
- ブリッジコストが手数料の節約額を下回る

Frontendでは両方の手数料見積もりが表示されるので、確認してから選択できます。

## 現在の手数料を確認する

Frontendでの確認手順：

1. **Wrap / Unwrap**モーダルを開く
2. **UNWRAP**タブを選択
3. 金額を入力

以下の情報が表示されます：
- **Same Chain**：現在のチェーンでUnwrapした場合の手数料
- **Different Chain**：クロスチェーンUnwrapの各オプションの手数料

比較して最もコスト効率のよい方法を選びましょう。

## 関連ページ

- [はじめに](frontend/getting-started.md) — Wrap / Unwrapの基本操作
- [Contract Spec: Incentive Curve](../developers/specs/contract-spec.md#incentive-curve) — 手数料カーブの技術的詳細
